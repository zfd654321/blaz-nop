<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=750,user-scalable=no" />
<link href="css/index.css" rel="stylesheet" type="text/css" />
<script src="../../js/httpService.js"></script>
<script src="../../js/jquery-3.1.0.min.js"></script>
<title>设备报警</title>
</head>

<body>

	<div class="main">
		<div class="text" id="text"></div>
		<div class="tittle" id="text">该设备最新kinect异常信息</div>
		<table id="list"></table>
		<div class="tittle" id="text">本次上报异常图片</div>
		<div class="errorimg"><img /></div>
	</div>


	<script>
		$(function() {
			var key_id = getQueryString('key_id');

			sendRequest(pageContextPath+'/Alarm/queryKinectError.do', {
				"key_id" : key_id
			}, function(jsonData) {
				var str = "<p>编号：" + jsonData.device.device_id + "</p><p>名称："
						+ jsonData.device.device_name + "的设备</p><p>("
						+ jsonData.device.device_desc + ")</p><p>在"
						+ jsonData.vo.appear_date + "</p><p>出现了"
						+ checkAppearType(jsonData.vo.appear_type) + "。</p>";
				$("#text").html(str);
				var tabletr="";
					tabletr+="<tr><th>异常类型</th><th>上报异常时间</th><th>报警时间</th><th>处理状态</th></tr>";
				for (var i = 0; i < jsonData.list.length; i++) {
					tabletr+="<tr><td>"+ checkAppearType(jsonData.list[i].appear_type) +"</td>";
					tabletr+="<td>"+ jsonData.list[i].appear_date +"</td>";
					tabletr+="<td>"+ jsonData.list[i].alarm_date +"</td>";
					tabletr+="<td>"+ checkIsDispose(jsonData.list[i].isDispose) +"</td></tr>"
				}
				$("#list").html(tabletr);
				
				$(".errorimg img").attr("src",jsonData.vo.appear_img_url);
			});

		})

		function checkAppearType(id) {
			var name = '';
			if ("1" == id) {
				name = "连接异常";
			} else if ("2" == id) {
				name = "摄像头异常";
			} else if ("3" == id) {
				name = "物品遮挡";
			}
			return name;
		}

		function getQueryString(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
			var r = window.location.search.substr(1).match(reg);
			if (r != null)
				return unescape(r[2]);
			return null;
		}
		function checkIsDispose(status){
			if(status=="Y"){
				return "已处理"
			}else{
				return "未处理"
			}
		}
	</script>




</body>